{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Using colourlovers patterns with ggplot2\"\nauthor: \"M. Salmon\"\ndate: \"21 de marzo de 2016\"\noutput: html_document\n---\n\n# Motivation\nThe [colourlovers package](https://github.com/leeper/colourlovers) connects R to the COLOURlovers API. Using the package, one can find colours, palettes, and patterns along with their evaluation.\n\nIn the README of the package Thomas Leeper wrote \"Patterns are images created on COLOURlovers using a specified palette of colors. They serve as examples of how to use the palette in practice.\". I think we could do more with them and use patterns for decorating figures.\n\nI opened an [issue](https://github.com/leeper/colourlovers/issues/4) a while ago about this idea. Since then, I've come up with a solution for decorating a geom_bar. It's not a general solution (yet?) but this code would be easy to modify to apply it to other analyses.\n\nThis document is a draft for a future vignette I'd like to submit to the colourlovers package.\n\n```{r, warning = FALSE, message = FALSE}\nlibrary(\"dplyr\")\nlibrary(\"tidyr\")\nlibrary(\"httr\")\nlibrary(\"grid\")\nlibrary(\"ggplot2\")\nlibrary(\"colourlovers\")\n\n```\n\n# General comments on using patterns\nA pattern is a square image that I convert to a raster. This raster is a matrix with 200 rows and 200 columns. In this matrix $x_{i,j}$ represents the hex code of the colour of a pixel. Below I show how to get a pattern figure and how to plot it on its own.\n\n```{r, cache = TRUE}\n# get pattern\ncatsBlue <- clpattern(id = \"3363032\")\n# get the URL of the picture corresponding to the pattern\nimageURL <- catsBlue$imageUrl\n# get the picture\n picture <-  content(GET(as.character(imageURL)))\n# convert it to a raster\nimg <- as.raster(picture)\n# plot it!\nplot(img)\n\n```\n\nThis pattern can also be seen as a puzzle piece: one can copy the pattern several times and put each copy side by side and/or pile them up and get something that looks homogeneous with no problem at the border of each piece.\n\nIn ggplot2, Il add the patterns with geom_point. The main issue will be to re-size puzzle pieces (how big should be a single puzzle piece for the graph to look nice?), to paste pieces together (now many puzzle pieces?), and to crop the puzzle (the puzzle should not be bigger than the bar it covers, for instance).\n\n# mtcars or mtcats?\n\nIn this example I'll decorate the very classical example of ggplot2 geom_bar.\n\nBelow is the original example.\n\n```{r}\n# Normal plot\nc <- ggplot(mtcars, aes(factor(cyl)))\nc <- c + geom_bar(width = .5,\n                  aes(fill = factor(cyl)))+\n  theme(text = element_text(size=20))\nc\n```\n\nNow, since my puzzle pieces are squares, I want the plot to have a x/y ratio such that the distance between two major grid lines on the x axis is the same as the distance as the distance between two major grid lines on the y axis. \n\n```{r}\nplotInfo <- ggplot_build(c)\nextentX <- diff(plotInfo$panel$ranges[[1]]$x.major_source)[1]\nextentY <- diff(plotInfo$panel$ranges[[1]]$y.major_source)[1]\nc <- c + coord_fixed(ratio = extentX/extentY)\nc\n```\n\nLater I shall use later the information `extentY`.\n\n\nI shall now get three patterns from colourlovers. I went on the website of colourlovers itself to find three patterns using the same template with different colours so I know their IDs.\n\n```{r}\n# get the patterns\ncatsBlue <- clpattern(id = \"3363032\")\ncatsRed <- clpattern(id = \"2741048\")\ncatsGreen <- clpattern(id = \"2904250\")\npatterns <- list(catsRed, catsGreen, catsBlue)\n\n```\n\nI shall first get one colour from each pattern and re-do the figure with these colours. I do this to have a legend later. I don't want to try and reproduce part of the patterns to get them in the legend.\n\n```{r}\ncatColors <- NULL\nfor (j in 1:3){\n  catColors <- c(catColors, patterns[[j]]$colors[2])\n}\ncatColors <- paste0(\"#\", catColors)\nc <- c + scale_fill_manual(values = catColors)\nc\n```\n\nNow I add the patterns by looping other the levels of factor(cyl).\n\n```{r, warning = FALSE}\nfor (i in 1:length(levels(factor(mtcars$cyl)))){\n  imageURL <- patterns[[i]]$imageUrl\n  # get pattern\n  picture <-  content(GET(as.character(imageURL)))\n  # picture is a 4 dimensional array\n  img <- as.raster(picture)\n  \n  # we have to repeat the data.frame/pattern\n  # I repeat it so that one extentY = one square\n  xmax <- 1\n  ymax <- sum(mtcars$cyl == levels(factor(mtcars$cyl))[i])\n  \n  size <- ceiling(ymax*2/extentY)\n  \n  img2 <- apply(img,MARGIN=2,function(x) rep(x,size))\n  \n  # from matrix to data.frame\n  img2 <- tbl_df(as.data.frame(as.matrix(img2)))\n  \n  # I change the column names so that they correspond to x coordinates \n  names(img2) <- seq(i - 0.25, to = i + 0.25, length = ncol(img2))\n  \n  # I transform the img2 so that I have one line = 1 x, 1 y and 1 colour\n  dataPlot <- img2 %>% \n    mutate(y = seq(from = size/2*extentY, to = 0, length = nrow(img2)))%>% \n    gather(x, value, 1:ncol(img2)) %>%\n    # filter part of the pattern that doesn't fit in the original bar\n    filter(y <= ymax)  %>%\n    mutate(x = as.numeric(x))\n  \n  \n  c <- c + geom_point(data = dataPlot, aes(x, y), col = dataPlot$value)\n}\nc\n```\n\nI'm not sure how useful this is. For me it was a great occasion to learn new things about graphics!\n\n\n# Squirrel example\n\nI'll add this later.",
    "created" : 1458739120395.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "814122035",
    "id" : "EAF74CF4",
    "lastKnownWriteTime" : 1458575548,
    "last_content_update" : 1458746307627,
    "path" : "C:/Users/msalmon/colourlovers_patterns/vignette_draft.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}